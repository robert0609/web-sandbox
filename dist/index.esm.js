import _forEachInstanceProperty from"@babel/runtime-corejs3/core-js-stable/instance/for-each";import _concatInstanceProperty from"@babel/runtime-corejs3/core-js-stable/instance/concat";import _spliceInstanceProperty from"@babel/runtime-corejs3/core-js-stable/instance/splice";import _indexOfInstanceProperty from"@babel/runtime-corejs3/core-js-stable/instance/index-of";import _toConsumableArray from"@babel/runtime-corejs3/helpers/toConsumableArray";import _Map from"@babel/runtime-corejs3/core-js-stable/map";import _bindInstanceProperty from"@babel/runtime-corejs3/core-js-stable/instance/bind";import _Object$create from"@babel/runtime-corejs3/core-js-stable/object/create";function hackTimer(e){var t=e.setInterval,n=e.setTimeout,o=[],r=[];return{hookSetInterval:function(e,n){for(var o,c=arguments.length,a=new Array(c>2?c-2:0),i=2;i<c;i++)a[i-2]=arguments[i];var s=t.apply(void 0,_concatInstanceProperty(o=[e,n]).call(o,a));return r.push(s),"development"===process.env.NODE_ENV&&console.log("Call setInterval. intervalId: ".concat(s)),s},hookSetTimeout:function(e,t){for(var r,c=arguments.length,a=new Array(c>2?c-2:0),i=2;i<c;i++)a[i-2]=arguments[i];var s=n.apply(void 0,_concatInstanceProperty(r=[e,t]).call(r,a));return o.push(s),"development"===process.env.NODE_ENV&&console.log("Call setTimeout. timerId: ".concat(s)),s},reset:function(){_forEachInstanceProperty(o).call(o,(function(t){e.clearTimeout(t),"development"===process.env.NODE_ENV&&console.log("ClearTimeout. timerId: ".concat(t))})),_forEachInstanceProperty(r).call(r,(function(t){e.clearInterval(t),"development"===process.env.NODE_ENV&&console.log("ClearInterval. intervalId: ".concat(t))}))}}}function hackEventListener(e){var t=e.addEventListener,n=e.removeEventListener,o=new _Map,r=function(t,r,c){var a,i=o.get(t);(i&&i.length&&-1!==_indexOfInstanceProperty(i).call(i,r)&&_spliceInstanceProperty(i).call(i,_indexOfInstanceProperty(i).call(i,r),1),"development"===process.env.NODE_ENV)&&console.log(_concatInstanceProperty(a="Call removeEventListener. eventName: ".concat(t,"; eventHandler: ")).call(a,r?r.toString():"null"));return n.call(e,t,r,c)};return{hookAddEventListener:function(n,r,c){var a,i,s=o.get(n)||[];(o.set(n,_concatInstanceProperty(a=[]).call(a,_toConsumableArray(s),[r])),"development"===process.env.NODE_ENV)&&console.log(_concatInstanceProperty(i="Call addEventListener. eventName: ".concat(n,"; eventHandler: ")).call(i,r?r.toString():"null"));return t.call(e,n,r,c)},hookRemoveEventListener:r,reset:function(){_forEachInstanceProperty(o).call(o,(function(e,t){var n;return _forEachInstanceProperty(n=_toConsumableArray(e)).call(n,(function(e){return r(t,e)}))}))}}}function createSandbox(e){var t,n=new _Map,o=new _Map,r=new _Map,c=e,a=_Object$create(null);return{sandbox:new Proxy(a,{get:function(e,n){if(t){var o=t(c,n);if(void 0!==o)return o}var r=c[n];return"function"==typeof r&&(r=_bindInstanceProperty(r).call(r,c)),r},set:function(t,a,i){if(o.has(a)?o.set(a,i):r.has(a)?r.set(a,i):Object.prototype.hasOwnProperty.call(c,a)?(n.set(a,c[a]),r.set(a,i)):o.set(a,i),c[a]=i,"development"===process.env.NODE_ENV){var s,l,u,d="";e instanceof Window?d="window":e instanceof Document?d="document":e instanceof HTMLElement&&(d=e.tagName),console.log(_concatInstanceProperty(s=_concatInstanceProperty(l=_concatInstanceProperty(u="Set ".concat(d,".")).call(u,a.toString()," to ")).call(l,i.toString(),"! Original value is ")).call(s,n.get(a)))}return!0},has:function(e,t){return t in c}}),reset:function(){_forEachInstanceProperty(o).call(o,(function(e,t){delete c[t]})),_forEachInstanceProperty(r).call(r,(function(e,t){c[t]=n.get(t)})),o.clear(),r.clear(),n.clear()},setGetProperty:function(e){t=e}}}var index={create:function create(source){var windowProxy=createSandbox(window),documentProxy=createSandbox(window.document),bodyProxy=createSandbox(window.document.body),timerWatcher=hackTimer(window),eventWatcherOfWindow=hackEventListener(window),eventWatcherOfDocument=hackEventListener(window.document),eventWatcherOfBody=hackEventListener(window.document.body);return windowProxy.setGetProperty((function(e,t){return"top"===t||"window"===t||"self"===t?windowProxy.sandbox:"document"===t?documentProxy.sandbox:"setInterval"===t?timerWatcher.hookSetInterval:"setTimeout"===t?timerWatcher.hookSetTimeout:"addEventListener"===t?eventWatcherOfWindow.hookAddEventListener:"removeEventListener"===t?eventWatcherOfWindow.hookRemoveEventListener:"Promise"===t?e.Promise:"Object"===t?e.Object:void 0})),documentProxy.setGetProperty((function(e,t){return"body"===t?bodyProxy.sandbox:"addEventListener"===t?eventWatcherOfDocument.hookAddEventListener:"removeEventListener"===t?eventWatcherOfDocument.hookRemoveEventListener:void 0})),bodyProxy.setGetProperty((function(e,t){return"addEventListener"===t?eventWatcherOfBody.hookAddEventListener:"removeEventListener"===t?eventWatcherOfBody.hookRemoveEventListener:void 0})),{mount:function mount(){var wrapperFunction=function wrapperFunction(window,document,setInterval,setTimeout){return eval(source)};return wrapperFunction.call(windowProxy.sandbox,windowProxy.sandbox,documentProxy.sandbox,timerWatcher.hookSetInterval,timerWatcher.hookSetTimeout)},mountWithCommonjs:function mountWithCommonjs(module,exports,require){var wrapperFunction=function wrapperFunction(window,document,setInterval,setTimeout,module,exports,require){eval(source)};wrapperFunction.call(windowProxy.sandbox,windowProxy.sandbox,documentProxy.sandbox,timerWatcher.hookSetInterval,timerWatcher.hookSetTimeout,module,exports,require)},unmount:function(){var e;_forEachInstanceProperty(e=[windowProxy,documentProxy,bodyProxy,timerWatcher,eventWatcherOfWindow,eventWatcherOfDocument,eventWatcherOfBody]).call(e,(function(e){e.reset()}))}}}};export default index;
