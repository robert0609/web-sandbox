{"version":3,"file":"index.min.js","sources":["../src/hackTimer.ts","../src/hackEventListener.ts","../src/globalProxy.ts","../src/index.ts"],"sourcesContent":["/*\n * @Author: bluefox\n * @Date: 2019-12-28 23:59:29\n * @Description: hack全局定时器\n */\n\nexport default function (target: Window) {\n  const originalWindowInterval = target.setInterval;\n  const originalWindowTimeout = target.setTimeout;\n\n  const timerIds: number[] = [];\n  const intervalIds: number[] = [];\n\n  const hookSetInterval = (handler: TimerHandler, timeout?: number, ...args: any[]) => {\n    const intervalId = originalWindowInterval(handler, timeout, ...args);\n    intervalIds.push(intervalId);\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(`Call setInterval. intervalId: ${intervalId}`);\n    }\n    return intervalId;\n  };\n\n  const hookSetTimeout = (handler: TimerHandler, timeout?: number, ...args: any[]) => {\n    const timerId = originalWindowTimeout(handler, timeout, ...args);\n    timerIds.push(timerId);\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(`Call setTimeout. timerId: ${timerId}`);\n    }\n    return timerId;\n  };\n\n  return {\n    hookSetInterval,\n    hookSetTimeout,\n    reset() {\n      timerIds.forEach(id => {\n        target.clearTimeout(id);\n        if (process.env.NODE_ENV === 'development') {\n          console.warn(`ClearTimeout. timerId: ${id}`);\n        }\n      });\n      intervalIds.forEach(id => {\n        target.clearInterval(id);\n        if (process.env.NODE_ENV === 'development') {\n          console.warn(`ClearInterval. intervalId: ${id}`);\n        }\n      });\n    }\n  };\n}\n","/*\n * @Author: bluefox\n * @Date: 2019-12-28 23:58:46\n * @Description: hack事件监听器\n */\n\nexport default function (target: EventTarget) {\n  const originalAddEventListener = target.addEventListener;\n  const originalRemoveEventListener = target.removeEventListener;\n\n  const listenerMap = new Map<string, EventListenerOrEventListenerObject[]>();\n\n  const hookAddEventListener = (\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions,\n  ) => {\n    const listeners = listenerMap.get(type) || [];\n    listenerMap.set(type, [...listeners, listener]);\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(`Call addEventListener. eventName: ${type}; eventHandler: ${listener.toString()}`);\n    }\n    return originalAddEventListener.call(target, type, listener, options);\n  };\n\n  const hookRemoveEventListener = (\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions,\n  ) => {\n    const storedTypeListeners = listenerMap.get(type);\n    if (storedTypeListeners && storedTypeListeners.length && storedTypeListeners.indexOf(listener) !== -1) {\n      storedTypeListeners.splice(storedTypeListeners.indexOf(listener), 1);\n    }\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(`Call removeEventListener. eventName: ${type}; eventHandler: ${listener.toString()}`);\n    }\n    return originalRemoveEventListener.call(target, type, listener, options);\n  };\n\n  return {\n    hookAddEventListener,\n    hookRemoveEventListener,\n    reset() {\n      listenerMap.forEach((listeners, type) =>\n        [...listeners].forEach(listener => hookRemoveEventListener(type, listener)),\n      );\n    }\n  };\n}\n","import { HtmlElementType } from \"./type\";\n\n/*\n * @Author: bluefox\n * @Date: 2019-12-28 23:58:30\n * @Description: 生成HTML元素的代理对象，包括window，document和HtmlElement\n */\nexport default function <T extends HtmlElementType>(target: T) {\n  // 沙箱期间被更新的全局变量的原始值\n  const modifiedPropsOriginalValueMapInSandbox = new Map<PropertyKey, any>();\n\n  // 沙箱期间新增的全局变量\n  const addedPropsMapInSandbox = new Map<PropertyKey, any>();\n  // 沙箱期间更新的全局变量\n  const updatedPropsMapInSandbox = new Map<PropertyKey, any>();\n\n  const originalTarget = target;\n  const fakeTarget = Object.create(null) as T;\n\n  let getProperty: null | ((originalTarget: T, p: PropertyKey) => any);\n\n  const sandbox: T = new Proxy(fakeTarget, {\n    get(_: T, p: PropertyKey): any {\n      if (getProperty) {\n        const v = getProperty(originalTarget, p);\n        if (v !== undefined) {\n          return v;\n        }\n      }\n      const v = (originalTarget as any)[p];\n      return v;\n    },\n    set(_: T, p: PropertyKey, v: any): boolean {\n      if (addedPropsMapInSandbox.has(p)) {\n        addedPropsMapInSandbox.set(p, v);\n      } else if (updatedPropsMapInSandbox.has(p)) {\n        updatedPropsMapInSandbox.set(p, v);\n      } else {\n        if (Object.prototype.hasOwnProperty.call(originalTarget, p)) {\n          modifiedPropsOriginalValueMapInSandbox.set(p, (originalTarget as any)[p]);\n          updatedPropsMapInSandbox.set(p, v);\n        } else {\n          addedPropsMapInSandbox.set(p, v);\n        }\n      }\n      (originalTarget as any)[p] = v;\n      if (process.env.NODE_ENV === 'development') {\n        let globalName = '';\n        if (target instanceof Window) {\n          globalName = 'window';\n        } else if (target instanceof Document) {\n          globalName = 'document';\n        } else if (target instanceof HTMLElement) {\n          globalName = target.tagName;\n        }\n        console.warn(`Set ${globalName}.${p.toString()} to ${v.toString()}! Original value is ${modifiedPropsOriginalValueMapInSandbox.get(p)}`);\n      }\n      return true;\n    },\n    has(_: T, p: PropertyKey): boolean {\n      return p in originalTarget;\n    }\n  });\n\n  const result = {\n    sandbox,\n    reset() {\n      addedPropsMapInSandbox.forEach((v, k) => {\n        delete (originalTarget as any)[k];\n      });\n      updatedPropsMapInSandbox.forEach((v, k) => {\n        (originalTarget as any)[k] = modifiedPropsOriginalValueMapInSandbox.get(k);\n      });\n      addedPropsMapInSandbox.clear();\n      updatedPropsMapInSandbox.clear();\n      modifiedPropsOriginalValueMapInSandbox.clear();\n    },\n    setGetProperty(cb: (originalTarget: T, p: PropertyKey) => any) {\n      getProperty = cb;\n    }\n  };\n\n  return result;\n}\n","import { ISandbox } from \"./interface/ISandbox\";\nimport hackTimer from \"./hackTimer\";\nimport hackEventListener from \"./hackEventListener\";\nimport createSandbox from './globalProxy';\n\n/*\n * @Author: bluefox\n * @Date: 2019-12-28 23:20:23\n * @Description: 浏览器端JavaScript脚本的沙盒执行环境，会记录全局变量的修改\n *               create方法返回沙盒环境，只有在调用mount挂载沙盒的时候，才会执行hack处理并且运行沙盒中的js逻辑\n */\n\nexport default {\n  create(source: string): ISandbox {\n    // 创建全局代理对象，监控全局属性的变化\n    const windowProxy = createSandbox(window);\n    const documentProxy = createSandbox(window.document);\n    const bodyProxy = createSandbox(window.document.body);\n    // 监听定时器的调用\n    const timerWatcher = hackTimer(window);\n    // 监控事件的绑定/解绑\n    const eventWatcherOfWindow = hackEventListener(window);\n    const eventWatcherOfDocument = hackEventListener(window.document);\n    const eventWatcherOfBody = hackEventListener(window.document.body);\n\n    windowProxy.setGetProperty((t, p) => {\n      if (p === 'top' || p === 'window' || p === 'self') {\n        return windowProxy.sandbox;\n      } else if (p === 'document') {\n        return documentProxy.sandbox;\n      } else if (p === 'setInterval') {\n        return timerWatcher.hookSetInterval;\n      } else if (p === 'setTimeout') {\n        return timerWatcher.hookSetTimeout;\n      } else if (p === 'addEventListener') {\n        return eventWatcherOfWindow.hookAddEventListener;\n      } else if (p === 'removeEventListener') {\n        return eventWatcherOfWindow.hookRemoveEventListener;\n      }\n    });\n    documentProxy.setGetProperty((t, p) => {\n      if (p === 'body') {\n        return bodyProxy.sandbox;\n      } else if (p === 'addEventListener') {\n        return eventWatcherOfDocument.hookAddEventListener;\n      } else if (p === 'removeEventListener') {\n        return eventWatcherOfDocument.hookRemoveEventListener;\n      }\n    });\n    bodyProxy.setGetProperty((t, p) => {\n      if (p === 'addEventListener') {\n        return eventWatcherOfBody.hookAddEventListener;\n      } else if (p === 'removeEventListener') {\n        return eventWatcherOfBody.hookRemoveEventListener;\n      }\n    });\n\n    return {\n      mount() {\n        const wrapperFunction = new Function('window', 'document', 'setInterval', 'setTimeout', source);\n        const result = wrapperFunction.call(windowProxy.sandbox, windowProxy.sandbox, documentProxy.sandbox, timerWatcher.hookSetInterval, timerWatcher.hookSetTimeout);\n        return result;\n      },\n      unmount() {\n        [ windowProxy, documentProxy, bodyProxy, timerWatcher, eventWatcherOfWindow, eventWatcherOfDocument, eventWatcherOfBody ].forEach(m => {\n          m.reset();\n        });\n      }\n    };\n  }\n};\n\n\n"],"names":["target","originalWindowInterval","setInterval","originalWindowTimeout","setTimeout","timerIds","intervalIds","hookSetInterval","handler","timeout","args","intervalId","push","process","env","NODE_ENV","console","warn","hookSetTimeout","timerId","reset","id","clearTimeout","clearInterval","originalAddEventListener","addEventListener","originalRemoveEventListener","removeEventListener","listenerMap","hookAddEventListener","type","listener","options","listeners","get","set","toString","call","hookRemoveEventListener","storedTypeListeners","length","modifiedPropsOriginalValueMapInSandbox","addedPropsMapInSandbox","updatedPropsMapInSandbox","originalTarget","fakeTarget","getProperty","sandbox","Proxy","_","p","v","undefined","has","Object","prototype","hasOwnProperty","globalName","Window","Document","HTMLElement","tagName","result","k","clear","setGetProperty","cb","create","source","windowProxy","createSandbox","window","documentProxy","document","bodyProxy","body","timerWatcher","hackTimer","eventWatcherOfWindow","hackEventListener","eventWatcherOfDocument","eventWatcherOfBody","t","mount","wrapperFunction","Function","unmount","m"],"mappings":"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"}